Drupal Development Template
===========================

## Overview

This repository contains custom configuration and source code only.

The site's full codebase is built using [grunt-drupal-build](https://www.npmjs.com/package/grunt-drupal-build).
The Drupal version and contributed projects are defined in Drush Make files and downloaded as part of the build process.

This prevents duplication of contributed code and ensures that all patches applied to these projects are documented (within Drush Make files for Drupal 7 and within composer.json for Drupal 8).


## Project Structure

- `.dcr` - Drupal Code Review configuration. See https://github.com/alexdesignworks/dcr.
- `build` - Files created by the build process. Generated by [grunt-drupal-build](https://www.npmjs.com/package/grunt-drupal-build). Ignored by git.
- `config` - Configuration files used for local development and/or GLA production environment(s).
  - `apache` - Apache configuration.
  - `drupal` - Drupal configuration.
    - `default` - Drupal configuration for "default" site.
      - `default` - Default Drupal configuration, common to all environments.
      - `local` - Drupal configuration for local development only.
      - `dev` - Drupal configuration for the development environment.
      - `test` - Drupal configuration for the testing environment.
      - `prod` - Drupal configuration for the live environment.
  - `php` - PHP configuration.
  - `solr` - Solr configuration.
- `data` - Data volume used by containers for local development. Ignored by git.
  - `drupal` - Drupal's data.
    - `default` - Drupal's default site's data.
      - `public` - Public files for default site.
      - `private` - Private files for default site.
      - `tmp` - Temporary files for default site.
  - `solr` - Solr's data.
- `drush` - Commands, configuration and site aliases for Drush
- `scripts` - Scripts used by Composer, CI systems, for deployment and for installation of dependencies for the build process.
- `src` - Source code for the site.
  - `build` - Drush Make files.
    - `patches` - Any patches applied to core/contrib projects.
  - `libraries` - Custom libraries for the site. Copied/symlinked into `sites/all/libraries/`.
  - `modules` - Custom modules for the site. Copied/symlinked into `sites/all/modules/custom/`.
  - `profiles` - Custom libraries for the site. Copied/symlinked into `profiles/`.
  - `sites` - Custom libraries for the site. Copied/symlinked into `profiles/`.
  - `themes` - Custom modules for the site. Copied/symlinked into `sites/all/themes/custom/`.
  - `www` - Custom files (useful for overriding `.htaccess` etc.). Copied/symlinked into Drupal's root directory.
- `web` - Site's codebase with symlinks to src directory. Generated by [grunt-drupal-build](https://www.npmjs.com/package/grunt-drupal-build). Ignored by git.
- `web-deploy` - Site's codebase with all custom projects copied rather than symlinked. Generated by [grunt-drupal-build](https://www.npmjs.com/package/grunt-drupal-build). Ignored by git.

## Initial Setup

### Requirements
Ensure that the following are available on your system:
- **docker** - https://docs.docker.com/docker-for-mac/install/
- **docker-compose** - https://docs.docker.com/compose/install/
- **composer** - https://getcomposer.org/doc/00-intro.md#globally
- **npm** - https://docs.npmjs.com/getting-started/installing-node
- **grunt** - `npm -g install grunt-cli`

#### Common Docker Containers
- Get configuration for common Docker containers provided by CraigGardener/docker-compose-global:

````
git clone git@github.com:CraigGardener/docker-compose-global.git ~/docker-compose-global
````

### Drupal 7
For developing a Drupal 7 site, run the following:

````
cp composer.d7.json composer.json
cp Gruntconfig.d7.json Gruntconfig.json
````

### Drupal 8
For developing a Drupal 8 site, run the following:

````
cp composer.d8.json composer.json
cp Gruntconfig.d7.json Gruntconfig.json
````

### Common
To install dependencies and set up the project for development, run the following:

````
npm install
composer install
vendor/bin/dcr/install
grunt
````

### Project
- Clone project's GitHub wiki:
````
git clone git@github.com:[USER]/[PROJECT].wiki.git documentation
````
- Copy example environment file for docker-compose:
````
cp docker-compose.example.env docker-compose.env
````
- Edit local environment file for docker-compose.

## Usage

To work with this project after initial set up:

### Building the Project

- `grunt`

### Running Containers

- Start project's containers:
````
docker-compose up -d
````
- Start common containers provided by CraigGardener/docker-compose-global:
````
cd ~/docker-compose-global
docker-compose up -d --project-name global
````

### Build scripts
For full documentation for the build script, see [grunt-drupal-build](https://www.npmjs.com/package/grunt-drupal-build).
